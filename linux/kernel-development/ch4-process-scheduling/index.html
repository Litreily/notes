<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Note Everything"><meta name=author content=Litreily><link href=http://www.litreily.top/notes/linux/kernel-development/ch4-process-scheduling/ rel=canonical><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.4.2, mkdocs-material-8.5.10"><title>进程调度 - Notes</title><link rel=stylesheet href=../../../assets/stylesheets/main.472b142f.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.08040f6c.min.css><meta name=theme-color content=#546d78><link rel=stylesheet href=../../../css/extra.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=blue-grey data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#_1 class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title=Notes class="md-header__button md-logo" aria-label=Notes data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Notes </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 进程调度 </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/Litreily/notes title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class="md-tabs__link md-tabs__link--active"> Linux C </a> </li> <li class=md-tabs__item> <a href=../../../commands/cd/ class=md-tabs__link> Commands </a> </li> <li class=md-tabs__item> <a href=../../../network/signle-arm-routing/ class=md-tabs__link> Network </a> </li> <li class=md-tabs__item> <a href=../../../os/ubuntu/userAdd/ class=md-tabs__link> OS </a> </li> <li class=md-tabs__item> <a href=../../../python/ class=md-tabs__link> Python </a> </li> <li class=md-tabs__item> <a href=../../../software/atom/ class=md-tabs__link> Software </a> </li> <li class=md-tabs__item> <a href=../../../web/css/ class=md-tabs__link> Web </a> </li> <li class=md-tabs__item> <a href=../../../appendix/ascii/ class=md-tabs__link> Appendix </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=Notes class="md-nav__button md-logo" aria-label=Notes data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5Z"/></svg> </a> Notes </label> <div class=md-nav__source> <a href=https://github.com/Litreily/notes title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1 checked> <label class=md-nav__link for=__nav_1> Linux C <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Linux C" data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Linux C </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../ class=md-nav__link> Linux </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1_3 type=checkbox id=__nav_1_3> <label class=md-nav__link for=__nav_1_3> Basic <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Basic data-md-level=2> <label class=md-nav__title for=__nav_1_3> <span class="md-nav__icon md-icon"></span> Basic </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../basic/preprocessor/ class=md-nav__link> Preprocessor </a> </li> <li class=md-nav__item> <a href=../../basic/keywords/ class=md-nav__link> Keywords </a> </li> <li class=md-nav__item> <a href=../../basic/makefile/ class=md-nav__link> Makefile </a> </li> <li class=md-nav__item> <a href=../../basic/weak_symbol/ class=md-nav__link> Weak Symbol </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1_4 type=checkbox id=__nav_1_4> <label class=md-nav__link for=__nav_1_4> Communications <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Communications data-md-level=2> <label class=md-nav__title for=__nav_1_4> <span class="md-nav__icon md-icon"></span> Communications </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../communications/i2c/ class=md-nav__link> I2C </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1_5 type=checkbox id=__nav_1_5 checked> <label class=md-nav__link for=__nav_1_5> 内核开发 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=内核开发 data-md-level=2> <label class=md-nav__title for=__nav_1_5> <span class="md-nav__icon md-icon"></span> 内核开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ch3-process-management/ class=md-nav__link> 进程管理 </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> 进程调度 <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> 进程调度 </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#linux class=md-nav__link> Linux 进程调度 </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 策略 </a> <nav class=md-nav aria-label=策略> <ul class=md-nav__list> <li class=md-nav__item> <a href=#io class=md-nav__link> I/O 消耗型和处理器消耗型进程 </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 进程优先级 </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 时间片 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 进程调度算法 </a> <nav class=md-nav aria-label=进程调度算法> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 调度器类 </a> </li> <li class=md-nav__item> <a href=#unix class=md-nav__link> Unix 系统中的进程调度 </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 公平调度 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#linux_1 class=md-nav__link> Linux 调度的实现 </a> <nav class=md-nav aria-label="Linux 调度的实现"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_8 class=md-nav__link> 时间记账 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1_6 type=checkbox id=__nav_1_6> <label class=md-nav__link for=__nav_1_6> 内核调试 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=内核调试 data-md-level=2> <label class=md-nav__title for=__nav_1_6> <span class="md-nav__icon md-icon"></span> 内核调试 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kernel-debug/ftrace/ class=md-nav__link> Ftrace </a> </li> <li class=md-nav__item> <a href=../../kernel-debug/watchdog/ class=md-nav__link> Watchdog </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Commands <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Commands data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Commands </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../commands/cd/ class=md-nav__link> cd </a> </li> <li class=md-nav__item> <a href=../../../commands/df/ class=md-nav__link> df </a> </li> <li class=md-nav__item> <a href=../../../commands/du/ class=md-nav__link> du </a> </li> <li class=md-nav__item> <a href=../../../commands/fc-cache/ class=md-nav__link> fc-cahe </a> </li> <li class=md-nav__item> <a href=../../../commands/ifconfig/ class=md-nav__link> ifconfig </a> </li> <li class=md-nav__item> <a href=../../../commands/ip/ class=md-nav__link> ip </a> </li> <li class=md-nav__item> <a href=../../../commands/ls/ class=md-nav__link> ls </a> </li> <li class=md-nav__item> <a href=../../../commands/lsb_release/ class=md-nav__link> lsb_release </a> </li> <li class=md-nav__item> <a href=../../../commands/man/ class=md-nav__link> man </a> </li> <li class=md-nav__item> <a href=../../../commands/mkdir/ class=md-nav__link> mkdir </a> </li> <li class=md-nav__item> <a href=../../../commands/mksquashfs/ class=md-nav__link> mksquashfs </a> </li> <li class=md-nav__item> <a href=../../../commands/mount/ class=md-nav__link> mount </a> </li> <li class=md-nav__item> <a href=../../../commands/ping/ class=md-nav__link> ping </a> </li> <li class=md-nav__item> <a href=../../../commands/pwd/ class=md-nav__link> pwd </a> </li> <li class=md-nav__item> <a href=../../../commands/openssl/ class=md-nav__link> openssl </a> </li> <li class=md-nav__item> <a href=../../../commands/rm/ class=md-nav__link> rm </a> </li> <li class=md-nav__item> <a href=../../../commands/rsync/ class=md-nav__link> rsync </a> </li> <li class=md-nav__item> <a href=../../../commands/sar/ class=md-nav__link> sar </a> </li> <li class=md-nav__item> <a href=../../../commands/sed/ class=md-nav__link> sed </a> </li> <li class=md-nav__item> <a href=../../../commands/sudo/ class=md-nav__link> sudo </a> </li> <li class=md-nav__item> <a href=../../../commands/xargs/ class=md-nav__link> xargs </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Network <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Network data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Network </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_1 type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1> Concepts <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Concepts data-md-level=2> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> Concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../network/signle-arm-routing/ class=md-nav__link> 单臂路由 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2 type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2> Protocol <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Protocol data-md-level=2> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Protocol </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../network/protocol/ class=md-nav__link> Protocol </a> </li> <li class=md-nav__item> <a href=../../../network/linkLayer/ class=md-nav__link> Link layer </a> </li> <li class=md-nav__item> <a href=../../../network/ip/ class=md-nav__link> IP </a> </li> <li class=md-nav__item> <a href=../../../network/arp/ class=md-nav__link> ARP </a> </li> <li class=md-nav__item> <a href=../../../network/icmp/ class=md-nav__link> ICMP </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3 type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3> Proxy <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Proxy data-md-level=2> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Proxy </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../network/proxy/ class=md-nav__link> Proxy </a> </li> <li class=md-nav__item> <a href=../../../network/cntlm/ class=md-nav__link> Cntlm </a> </li> <li class=md-nav__item> <a href=../../../network/frp/ class=md-nav__link> Frp </a> </li> <li class=md-nav__item> <a href=../../../network/proxychains4/ class=md-nav__link> Proxychains4 </a> </li> <li class=md-nav__item> <a href=../../../network/shadowsocks/ class=md-nav__link> ShadowSocks </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_4 type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4> Tools <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Tools data-md-level=2> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../network/iperf/ class=md-nav__link> iperf </a> </li> <li class=md-nav__item> <a href=../../../network/tc/ class=md-nav__link> tc </a> </li> <li class=md-nav__item> <a href=../../../network/wireshark/ class=md-nav__link> Wireshark </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_5 type=checkbox id=__nav_3_5> <label class=md-nav__link for=__nav_3_5> Apps <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Apps data-md-level=2> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> Apps </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../network/samba/ class=md-nav__link> samba </a> </li> <li class=md-nav__item> <a href=../../../network/tftp/ class=md-nav__link> tftp </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> OS <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=OS data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> OS </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_1 type=checkbox id=__nav_4_1> <label class=md-nav__link for=__nav_4_1> Ubuntu <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Ubuntu data-md-level=2> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> Ubuntu </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../os/ubuntu/userAdd/ class=md-nav__link> Add user </a> </li> <li class=md-nav__item> <a href=../../../os/ubuntu/aws_ec2/ class=md-nav__link> AWS EC2 </a> </li> <li class=md-nav__item> <a href=../../../os/ubuntu/faq/ class=md-nav__link> FAQ </a> </li> <li class=md-nav__item> <a href=../../../os/ubuntu/installer/ class=md-nav__link> Installer </a> </li> <li class=md-nav__item> <a href=../../../os/ubuntu/route/ class=md-nav__link> Soft route </a> </li> <li class=md-nav__item> <a href=../../../os/ubuntu/shell/ class=md-nav__link> Shell </a> </li> <li class=md-nav__item> <a href=../../../os/ubuntu/shellScripts/ class=md-nav__link> Shell scripts </a> </li> <li class=md-nav__item> <a href=../../../os/ubuntu/themes/ class=md-nav__link> Themes </a> </li> <li class=md-nav__item> <a href=../../../os/ubuntu/vps/ class=md-nav__link> VPS </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_2 type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2> Windows <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Windows data-md-level=2> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Windows </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../os/windows/powershell/ class=md-nav__link> PowerShell </a> </li> <li class=md-nav__item> <a href=../../../os/windows/cmd/ class=md-nav__link> CMD </a> </li> <li class=md-nav__item> <a href=../../../os/windows/wsl/ class=md-nav__link> WSL </a> </li> <li class=md-nav__item> <a href=../../../os/windows/faq/ class=md-nav__link> FAQ </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Python <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Python data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Python </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5_1 type=checkbox id=__nav_5_1> <label class=md-nav__link for=__nav_5_1> general <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=general data-md-level=2> <label class=md-nav__title for=__nav_5_1> <span class="md-nav__icon md-icon"></span> general </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../python/ class=md-nav__link> general </a> </li> <li class=md-nav__item> <a href=../../../python/install/ class=md-nav__link> General </a> </li> <li class=md-nav__item> <a href=../../../python/decorator/ class=md-nav__link> Decorator </a> </li> <li class=md-nav__item> <a href=../../../python/generator/ class=md-nav__link> Generator </a> </li> <li class=md-nav__item> <a href=../../../python/iterator/ class=md-nav__link> Iterator </a> </li> <li class=md-nav__item> <a href=../../../python/lambda/ class=md-nav__link> Lambda </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../python/download/ class=md-nav__link> Download </a> </li> <li class=md-nav__item> <a href=../../../python/nic/ class=md-nav__link> NIC </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6> Software <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Software data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Software </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../software/atom/ class=md-nav__link> Atom </a> </li> <li class=md-nav__item> <a href=../../../software/chrome/ class=md-nav__link> Chrome </a> </li> <li class=md-nav__item> <a href=../../../software/docker/ class=md-nav__link> Docker </a> </li> <li class=md-nav__item> <a href=../../../software/git/ class=md-nav__link> Git </a> </li> <li class=md-nav__item> <a href=../../../software/gitbook/ class=md-nav__link> Gitbook </a> </li> <li class=md-nav__item> <a href=../../../software/gitlab/ class=md-nav__link> Gitlab </a> </li> <li class=md-nav__item> <a href=../../../software/hexo/ class=md-nav__link> Hexo </a> </li> <li class=md-nav__item> <a href=../../../software/nodejs/ class=md-nav__link> Nodejs </a> </li> <li class=md-nav__item> <a href=../../../software/cscope/ class=md-nav__link> Cscope </a> </li> <li class=md-nav__item> <a href=../../../software/teraterm/ class=md-nav__link> Teraterm </a> </li> <li class=md-nav__item> <a href=../../../software/tex/ class=md-nav__link> Tex </a> </li> <li class=md-nav__item> <a href=../../../software/tmux/ class=md-nav__link> Tmux </a> </li> <li class=md-nav__item> <a href=../../../software/vim/ class=md-nav__link> VIM </a> </li> <li class=md-nav__item> <a href=../../../software/vsc/ class=md-nav__link> VSCode </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6_15 type=checkbox id=__nav_6_15> <label class=md-nav__link for=__nav_6_15> Database <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Database data-md-level=2> <label class=md-nav__title for=__nav_6_15> <span class="md-nav__icon md-icon"></span> Database </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../db/mongodb/ class=md-nav__link> MongoDB </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7> Web <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Web data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Web </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../web/css/ class=md-nav__link> CSS </a> </li> <li class=md-nav__item> <a href=../../../web/LNMP/ class=md-nav__link> LNMP </a> </li> <li class=md-nav__item> <a href=../../../web/kodbox/ class=md-nav__link> Kodbox </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8 type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8> Appendix <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Appendix data-md-level=1> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Appendix </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../appendix/ascii/ class=md-nav__link> ASCII </a> </li> <li class=md-nav__item> <a href=../../../appendix/gsm/ class=md-nav__link> GSM </a> </li> <li class=md-nav__item> <a href=../../../appendix/sms/ class=md-nav__link> SMS </a> </li> <li class=md-nav__item> <a href=../../../appendix/aphorisms/ class=md-nav__link> Aphorisms </a> </li> <li class=md-nav__item> <a href=../../../appendix/books/ class=md-nav__link> Book List </a> </li> <li class=md-nav__item> <a href=../../../appendix/favorites/ class=md-nav__link> Favorites </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8_7 type=checkbox id=__nav_8_7> <label class=md-nav__link for=__nav_8_7> Tools <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Tools data-md-level=2> <label class=md-nav__title for=__nav_8_7> <span class="md-nav__icon md-icon"></span> Tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../appendix/tools/common/ class=md-nav__link> common </a> </li> <li class=md-nav__item> <a href=../../../appendix/tools/network/ class=md-nav__link> network </a> </li> <li class=md-nav__item> <a href=../../../appendix/tools/programming/ class=md-nav__link> programming </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#linux class=md-nav__link> Linux 进程调度 </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 策略 </a> <nav class=md-nav aria-label=策略> <ul class=md-nav__list> <li class=md-nav__item> <a href=#io class=md-nav__link> I/O 消耗型和处理器消耗型进程 </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 进程优先级 </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 时间片 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 进程调度算法 </a> <nav class=md-nav aria-label=进程调度算法> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 调度器类 </a> </li> <li class=md-nav__item> <a href=#unix class=md-nav__link> Unix 系统中的进程调度 </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 公平调度 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#linux_1 class=md-nav__link> Linux 调度的实现 </a> <nav class=md-nav aria-label="Linux 调度的实现"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_8 class=md-nav__link> 时间记账 </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/Litreily/notes/tree/mkdocs/docs/linux/kernel-development/ch4-process-scheduling.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1 id=_1>进程调度<a class=headerlink href=#_1 title="Permanent link">&para;</a></h1> <blockquote> <p>Linux Kernel Development ch4: Process Scheduling</p> </blockquote> <p>多任务操作系统的进程调度分为非抢占式调度和抢占式调度，现代操作系统基本上都采用了抢占式调度。</p> <h2 id=linux>Linux 进程调度<a class=headerlink href=#linux title="Permanent link">&para;</a></h2> <ol> <li>2.4 kernel 调度器: 设计简单、粗糙，易于理解，但是难以胜任过多可执行进程</li> <li>2.5 kerenl 调度器：大型改造，O(1)调度器，算法优化</li> <li>2.6 kernel 调度器：针对交互进程，吸取队列理论，设计RSDL调度，后更新为Completely Fair Scheduler(CFS)</li> </ol> <h2 id=_2>策略<a class=headerlink href=#_2 title="Permanent link">&para;</a></h2> <p><code>Policy</code>决定调度程序何时让什么进程运行。</p> <h3 id=io>I/O 消耗型和处理器消耗型进程<a class=headerlink href=#io title="Permanent link">&para;</a></h3> <ul> <li>I/O 消耗型：大量的I/O请求，大部分时间在阻塞态等待I/O数据</li> <li>处理器消耗型：大部分时间在执行代码，基本不阻塞去等待I/O，比如ssh keygen和MATLAB</li> </ul> <p>进程可能同时包含以上两种行为。调度器策略需要尝试满足两种冲突需求：快速的进程响应和最大化系统利用率。为了实现这个目标，调度器使用了非常复杂的算法去决定最值得执行的进程。</p> <p>Unix系统偏向于I/O消耗型进程，可以提供好的进程响应时间。Linux为了提供好的交互响应和桌面性能，优化了进程响应，更倾向于有优先调度I/O消耗型进程。</p> <h3 id=_3>进程优先级<a class=headerlink href=#_3 title="Permanent link">&para;</a></h3> <p>Linux采用两种优先级策略，nice值和实时优先级。</p> <ol> <li>nice值：<code>-20 ~ 19</code>, nice值越小，优先级越高。 Linux系统使用<code>ps -el</code>，<code>NI</code>列对应的就是nice值，它代表时间片的比例。</li> <li>实时优先级：<code>0 ~ 90</code>, 与nice值相反，数值越高优先级越高。其值可配。查看实时进程的方式如下(rtprio)</li> </ol> <div class=highlight><pre><span></span><code>ps -eo state,uid,pid,ppid,rtprio,time,comm
</code></pre></div> <p>输出结果中<code>rtprio</code>为<code>-</code>代表不是实时进程。</p> <div class="admonition note"> <p class=admonition-title>Note</p> <ol> <li>实时进程优先级高于普通进程</li> <li>Linux的实时优先级与nice优先级互不相交</li> </ol> </div> <h3 id=_4>时间片<a class=headerlink href=#_4 title="Permanent link">&para;</a></h3> <p>调度器必须指定一个默认的时间片，但这并不简单。如果时间片过长，会导致系统交互性能变差，就感觉应用程序不是并发执行的。如果时间片过短，就会导致处理器浪费大量时间进行进程切换。同时I/O消耗型和处理器消耗型的矛盾也会显现，I/O消耗型的进程无需长的时间片，处理器消耗型的进程则相反。</p> <p>较长时间片会导致系统性能低下，因此大多数操作系统的时间片都较短，比如10ms。Linux使用CFS调度器，不直接分配时间片给进程，而是将处理器使用比例分配给进程。在Linux中，进程处理时间由系统负载决定。此外，处理比例还与nice值有关系，nice值越高，处理器比例越低，反之亦然。</p> <p>Linux系统是抢占式的，当一个进程进入可运行态，CFS调度器会根据分配给进程的处理比例去决定什么时候将其投入运行。如果比例低，则立即执行，抢占当前进程。否则延迟执行。</p> <h2 id=_5>进程调度算法<a class=headerlink href=#_5 title="Permanent link">&para;</a></h2> <h3 id=_6>调度器类<a class=headerlink href=#_6 title="Permanent link">&para;</a></h3> <p>Linux调度器是模块化的，针对不同类型的进程，可以使用不同算法进行调度。这种模块化被称之为 <strong>调度器类</strong> (scheduler classes).调度器类允许不同的、可动态添加的调度方法去调度它们能够处理的进程。每个调度器类都有一个优先级。基本调度代码位于<code>kernel/sched.c</code>, 它会按照优先级顺序遍历调度类，拥有最高优先级的调度器类生出，并选择下面要执行的程序。</p> <p>完全公平调度Completely Fair Scheduler(CFS)是用于常用进程的调度器类，在Linux系统中为<code>SCHED_NORMAL</code>, 位于<code>kernel/sched_fair.c</code>.</p> <h3 id=unix>Unix 系统中的进程调度<a class=headerlink href=#unix title="Permanent link">&para;</a></h3> <p>在UNIX系统中，优先级以nice值的方式输出到用户空间，这虽然看起来简单，但实际涉及很多反常问题。</p> <p>首先，映射nice值到时间片需要确定每个nice值对应分配具体多大的时间片？假设有两个进程，一个是默认优先级(nice=0), 另一个是最低优先级(nice=20), 同时假设每个时间片最小单位为5ms. 那么两个进程的时间片分配如下：</p> <table> <thead> <tr> <th>nice</th> <th>timeslices</th> <th>frequency</th> </tr> </thead> <tbody> <tr> <td>0 (default)</td> <td>100ms</td> <td>100 / 105</td> </tr> <tr> <td>20 (lowest priority)</td> <td>5ms</td> <td>5 / 105</td> </tr> </tbody> </table> <p>如果有两个同等优先级(nice=20)的进程呢？按照上面的分配方式，每个进程都将获得5ms的时间片，然后每隔5ms切换一次，两个进程确实获得了50%的处理时间，但是切换过于频繁，大大浪费了CPU资源。以此类推，如果是两个普通进程，优先级nice=0, 它们同样可以获得50%的处理器时间，但是以100ms为增量。显然这种分配方式是不理想的，对于优先级不同的进程，虽然时间占比是合理的，但是实际的处理时间却是不理想的。</p> <p>而且，通常高nice值(低优先级)的进程是后台进程，是计算密集型，需要连续执行较长时间，按照以上方式却将分得很少的时间片；而普通优先级进程多是前台用户任务，大多是I/O消耗型，大部分时间处于阻塞状态，按照以上方式却将获得更多的时间片。由此来看，以上分配方式是不合理的。</p> <p>接下来看另外一个问题，同样是nice值相关的。</p> <table> <thead> <tr> <th>nice</th> <th>timeslices</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>100ms</td> </tr> <tr> <td>1</td> <td>95ms</td> </tr> <tr> <td>18</td> <td>10ms</td> </tr> <tr> <td>19</td> <td>5ms</td> </tr> </tbody> </table> <p>nice值为0, 1的两个进程，时间片差5ms，但直观上看相差无几；但是nice值为18, 19的两个进程，时间片同样相差5ms，但却是相差两倍的处理器时间。由于nice值通常使用相对值（系统调用接受一个增量，而不是绝对值），这意味着“把进程的nice值减1”带来的影响很大程度取决于它的初始nice值。</p> <p>第三个问题，如果需要映射nice值到时间片，就需要设定一个绝对的时间片。并且这个绝对值必须是内核可测量的。在大部分操作系统中，这意味着时间片必须是定时器节拍(timer tick)的整数倍。但这会引发几个问题，第一，最小时间片必须是定时器节拍的整数倍，可能是10ms，也可能是1ms；第二，系统定时器限制了时间片的差异：连续的nice值映射到时间片，差别多至10ms或者少则1ms；最后，时间片还随着定时器节拍不同而改变。</p> <p>第四个问题，基于优先级的调度器可能为了优化交互任务而唤醒相关进程，这种系统中，可能为了进程能更快的投入运行，而去提升要唤醒的进程的优先级，即便它们的时间片已经耗尽。这样虽然可以提升交互性能，但也有可能给某些特殊的睡眠用例开了后门，打破了公平原则，获取更多处理器时间，损害了其它进程的利益。</p> <p>上面的绝大多数问题通过改造Unix调度器都可以解决，比如将nice值呈几何增加而不是算数增加，这样可以解决上面第二个问题；使用新的度量机制将nice值到时间片的映射与定时器节拍分离，以解决第三个问题。但这些都没有解决实质问题—— <strong>分配绝对的时间片引发的固定切换频率</strong> ，给公平性造成很大变数。而CFS采用的方法是对时间片分配方式进行根本性的重新设计，完全摒弃时间片，并分配给进程一个 <strong>处理器使用比重</strong> (proportion of the processor), 通过这种方式，CFS实现了完全公平调度，并将切换频率置于不断变换当中。</p> <h3 id=_7>公平调度<a class=headerlink href=#_7 title="Permanent link">&para;</a></h3> <p>CFS 基于一个简单的概念：进程调度的效果表现得这个系统有一个理想、完美的多任务处理器。在这样一个系统中，每个进程将获得 <span class=arithmatex>\(1/n\)</span> 的处理器时间，<code>n</code> 代表可运行的进程数，我们可以调度给它们无限小的时间周期，所以在任何可测量周期内，我们给了n个进程中每个进程同样多的运行时间。</p> <p>举例说明，原本的UNIX系统中，假设一个进程运行5ms后另一个进程再运行5ms，每个进程在运行时占用100%的处理器。而在一个理想完美的多任务处理器中，我们可以保证10ms内同时运行两个进程，每个占用 <span class=arithmatex>\(50\%\)</span> 的处理器能力。</p> <p>当然，这种理想模型是不现实的，我们无法在一个处理器上真的同时运行多个进程。而且每个进程运行无限小的时间周期也是低效的，因为每次进程抢占都需要付出代价。</p> <p>那么CFS是怎么做的呢？CFS允许每个进程运行一段时间、循环轮转、选择运行最少的进程作为下一个运行进程，不再采用分配每个进程时间片的做法，CFS在所有可运行进程总数基础上计算出一个进程应该运行多久，而不是依赖nice值计算时间片。nice值在CFS中被作为进程获得处理器运行比的权重，nice值越大权重越低，反之亦然。</p> <p>nice值对应的权重可以参考<code>kernel/sched/sched.h</code>中的<code>prio_to_weight</code>.</p> <div class=highlight><pre><span></span><code><span class=cm>/*</span>
<span class=cm> * Nice levels are multiplicative, with a gentle 10% change for every</span>
<span class=cm> * nice level changed. I.e. when a CPU-bound task goes from nice 0 to</span>
<span class=cm> * nice 1, it will get ~10% less CPU time than another CPU-bound task</span>
<span class=cm> * that remained on nice 0.</span>
<span class=cm> *</span>
<span class=cm> * The &quot;10% effect&quot; is relative and cumulative: from _any_ nice level,</span>
<span class=cm> * if you go up 1 level, it&#39;s -10% CPU usage, if you go down 1 level</span>
<span class=cm> * it&#39;s +10% CPU usage. (to achieve that we use a multiplier of 1.25.</span>
<span class=cm> * If a task goes up by ~10% and another task goes down by ~10% then</span>
<span class=cm> * the relative distance between them is ~25%.)</span>
<span class=cm> */</span><span class=w></span>
<span class=k>static</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>prio_to_weight</span><span class=p>[</span><span class=mi>40</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w> </span><span class=cm>/* -20 */</span><span class=w>     </span><span class=mi>88761</span><span class=p>,</span><span class=w>     </span><span class=mi>71755</span><span class=p>,</span><span class=w>     </span><span class=mi>56483</span><span class=p>,</span><span class=w>     </span><span class=mi>46273</span><span class=p>,</span><span class=w>     </span><span class=mi>36291</span><span class=p>,</span><span class=w></span>
<span class=w> </span><span class=cm>/* -15 */</span><span class=w>     </span><span class=mi>29154</span><span class=p>,</span><span class=w>     </span><span class=mi>23254</span><span class=p>,</span><span class=w>     </span><span class=mi>18705</span><span class=p>,</span><span class=w>     </span><span class=mi>14949</span><span class=p>,</span><span class=w>     </span><span class=mi>11916</span><span class=p>,</span><span class=w></span>
<span class=w> </span><span class=cm>/* -10 */</span><span class=w>      </span><span class=mi>9548</span><span class=p>,</span><span class=w>      </span><span class=mi>7620</span><span class=p>,</span><span class=w>      </span><span class=mi>6100</span><span class=p>,</span><span class=w>      </span><span class=mi>4904</span><span class=p>,</span><span class=w>      </span><span class=mi>3906</span><span class=p>,</span><span class=w></span>
<span class=w> </span><span class=cm>/*  -5 */</span><span class=w>      </span><span class=mi>3121</span><span class=p>,</span><span class=w>      </span><span class=mi>2501</span><span class=p>,</span><span class=w>      </span><span class=mi>1991</span><span class=p>,</span><span class=w>      </span><span class=mi>1586</span><span class=p>,</span><span class=w>      </span><span class=mi>1277</span><span class=p>,</span><span class=w></span>
<span class=w> </span><span class=cm>/*   0 */</span><span class=w>      </span><span class=mi>1024</span><span class=p>,</span><span class=w>       </span><span class=mi>820</span><span class=p>,</span><span class=w>       </span><span class=mi>655</span><span class=p>,</span><span class=w>       </span><span class=mi>526</span><span class=p>,</span><span class=w>       </span><span class=mi>423</span><span class=p>,</span><span class=w></span>
<span class=w> </span><span class=cm>/*   5 */</span><span class=w>       </span><span class=mi>335</span><span class=p>,</span><span class=w>       </span><span class=mi>272</span><span class=p>,</span><span class=w>       </span><span class=mi>215</span><span class=p>,</span><span class=w>       </span><span class=mi>172</span><span class=p>,</span><span class=w>       </span><span class=mi>137</span><span class=p>,</span><span class=w></span>
<span class=w> </span><span class=cm>/*  10 */</span><span class=w>       </span><span class=mi>110</span><span class=p>,</span><span class=w>        </span><span class=mi>87</span><span class=p>,</span><span class=w>        </span><span class=mi>70</span><span class=p>,</span><span class=w>        </span><span class=mi>56</span><span class=p>,</span><span class=w>        </span><span class=mi>45</span><span class=p>,</span><span class=w></span>
<span class=w> </span><span class=cm>/*  15 */</span><span class=w>        </span><span class=mi>36</span><span class=p>,</span><span class=w>        </span><span class=mi>29</span><span class=p>,</span><span class=w>        </span><span class=mi>23</span><span class=p>,</span><span class=w>        </span><span class=mi>18</span><span class=p>,</span><span class=w>        </span><span class=mi>15</span><span class=p>,</span><span class=w></span>
<span class=p>};</span><span class=w></span>
</code></pre></div> <p>CFS为完美多任务中的无限小调度周期的近似值设定了一个目标，称为“目标延迟”，可以认为就是一个调度周期，代表着同一个进程两次被调度的间隔时间。</p> <p>现在，假设有两个进程，nice值分别为0和5，那么根据上面的映射数组可知，nice值为0的权重为 1024, nice 值为5的权重为335，差不多3倍关系，那么如果调度周期为20ms，则nice为0的进程将获得</p> <p><span class=arithmatex>\(20*(3/(3+1))=20*(3/4)=15ms\)</span></p> <p>的处理时间，nice为5的则是5ms. 同理，如果是nice值为10和15的两个进程，权重比也约为3倍，同样分别获得15ms和5ms的处理时间。可见绝对的nice值不再影响调度决策，只有相对值才会影响处理器时间的分配比例。</p> <p>总结下，任何进程的处理器时间都是有其和其它所有可运行进程的nice值的相对差值决定，nice值对时间片不再是算数加权，而是几何加权。nice值对应的不是绝对时间，而是处理器的使用比。CFS的公平调度是因为它确保每个进程公平的处理器使用比。CFS不是完美的公平，只是近乎完美。但在绝大多数多进程环境下，降低了调度延迟带来的不公平性。</p> <h2 id=linux_1>Linux 调度的实现<a class=headerlink href=#linux_1 title="Permanent link">&para;</a></h2> <p>CFS的调度算法相关代码位于 <code>kernel/sched_fair.c</code> 文件，主要关注其中4个部分。</p> <ul> <li>时间记账</li> <li>进程选择</li> <li>调度器入口</li> <li>睡眠与唤醒</li> </ul> <h3 id=_8>时间记账<a class=headerlink href=#_8 title="Permanent link">&para;</a></h3> <p>所有的调度器都需要对进程的运行时间记账，也就是说，需要记录当前调度周期内，进程还剩下多少时间片可以用。</p> <p><strong>调度器实体结构</strong> <code>sched_entity</code> 定义于 <code>&lt;linux/sched.h&gt;</code>, 被CFS调度器用于追踪进程运行的时间记账。</p> <div class=highlight><pre><span></span><code><span class=k>struct</span><span class=w> </span><span class=nc>sched_entity</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>load_weight</span><span class=w> </span><span class=n>load</span><span class=p>;</span><span class=w> </span><span class=c1>// 权重，与优先级相关</span>
<span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>rb_node</span><span class=w> </span><span class=n>run_node</span><span class=p>;</span><span class=w> </span><span class=c1>// 红黑树的节点</span>
<span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>list_head</span><span class=w> </span><span class=n>group_node</span><span class=p>;</span><span class=w> </span><span class=c1>// 所在进程组</span>
<span class=w>    </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>on_rq</span><span class=p>;</span><span class=w> </span><span class=c1>// 标记是否处于红黑树运行队列中</span>

<span class=w>    </span><span class=n>u64</span><span class=w> </span><span class=n>exec_start</span><span class=p>;</span><span class=w> </span><span class=c1>// 进程开始执行的时间</span>
<span class=w>    </span><span class=n>u64</span><span class=w> </span><span class=n>sum_exec_runtime</span><span class=p>;</span><span class=w> </span><span class=c1>// 进程总运行时间</span>
<span class=hll><span class=w>    </span><span class=n>u64</span><span class=w> </span><span class=n>vruntime</span><span class=p>;</span><span class=w> </span><span class=c1>// 虚拟运行时间</span>
</span><span class=w>    </span><span class=n>u64</span><span class=w> </span><span class=n>prev_sum_exec_runtime</span><span class=p>;</span><span class=w> </span><span class=c1>// 进程在切换CPU时的sum_exec_runtime</span>

<span class=w>    </span><span class=n>u64</span><span class=w> </span><span class=n>last_wakeup</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=n>u64</span><span class=w> </span><span class=n>avg_overlap</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=n>u64</span><span class=w> </span><span class=n>nr_migrations</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=n>u64</span><span class=w> </span><span class=n>start_runtime</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=n>u64</span><span class=w> </span><span class=n>avg_wakeup</span><span class=p>;</span><span class=w></span>

<span class=cm>/* many stat variables elided, enabled only if CONFIG_SCHEDSTATS is set */</span><span class=w></span>
<span class=p>};</span><span class=w></span>
</code></pre></div> <p>该结构被嵌入在进程描述符<code>struct task_struct</code>中，对应名为<code>se</code>的成员变量。</p> <p>关于上面高亮的部分，也就是 <strong>虚拟运行时间</strong> <code>vruntime</code>, 不同于进程的实际运行时间，虚拟运行时间的计算是实际运行时间经过了所有可运行进程总数的标准化（或者说是加权）后的值。以ns为单位，与定时器节拍不再相关。</p> <p>CFS为了实现理想多任务处理器虚拟出了这个时钟，一个进程的<code>vruntime</code>随着运行时间增加而增加，但是增加的速度由其所在的权重决定，其权重又与nice值相关。</p> <p>权重越高，说明优先级越高，那么<code>vruntime</code>的增长速率就越小；反之权重越低，优先级越低，那么<code>vruntime</code>的增长速率就越大，感觉时间很快就耗尽了。</p> <p>下面来看下记账时间的更新，是在文件<code>kernel/sched_fair.c</code>的函数<code>update_curr</code>中完成的。</p> <div class=highlight><pre><span></span><code><span class=k>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>update_curr</span><span class=p>(</span><span class=k>struct</span><span class=w> </span><span class=nc>cfs_rq</span><span class=w> </span><span class=o>*</span><span class=n>cfs_rq</span><span class=p>)</span><span class=w></span>
<span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>sched_entity</span><span class=w> </span><span class=o>*</span><span class=n>curr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>cfs_rq</span><span class=o>-&gt;</span><span class=n>curr</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=n>u64</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rq_of</span><span class=p>(</span><span class=n>cfs_rq</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>clock</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>delta_exec</span><span class=p>;</span><span class=w></span>

<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>unlikely</span><span class=p>(</span><span class=o>!</span><span class=n>curr</span><span class=p>))</span><span class=w></span>
<span class=w>        </span><span class=k>return</span><span class=p>;</span><span class=w></span>

<span class=w>    </span><span class=cm>/*</span>
<span class=cm>    * Get the amount of time the current task was running</span>
<span class=cm>    * since the last time we changed load (this cannot</span>
<span class=cm>    * overflow on 32 bits):</span>
<span class=cm>    */</span><span class=w></span>
<span class=hll><span class=w>    </span><span class=n>delta_exec</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=kt>unsigned</span><span class=w> </span><span class=kt>long</span><span class=p>)(</span><span class=n>now</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>curr</span><span class=o>-&gt;</span><span class=n>exec_start</span><span class=p>);</span><span class=w></span>
</span><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>delta_exec</span><span class=p>)</span><span class=w></span>
<span class=w>        </span><span class=k>return</span><span class=p>;</span><span class=w></span>

<span class=hll><span class=w>    </span><span class=n>__update_curr</span><span class=p>(</span><span class=n>cfs_rq</span><span class=p>,</span><span class=w> </span><span class=n>curr</span><span class=p>,</span><span class=w> </span><span class=n>delta_exec</span><span class=p>);</span><span class=w></span>
</span><span class=w>    </span><span class=n>curr</span><span class=o>-&gt;</span><span class=n>exec_start</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=p>;</span><span class=w></span>

<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>entity_is_task</span><span class=p>(</span><span class=n>curr</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>        </span><span class=k>struct</span><span class=w> </span><span class=nc>task_struct</span><span class=w> </span><span class=o>*</span><span class=n>curtask</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>task_of</span><span class=p>(</span><span class=n>curr</span><span class=p>);</span><span class=w></span>

<span class=w>        </span><span class=n>trace_sched_stat_runtime</span><span class=p>(</span><span class=n>curtask</span><span class=p>,</span><span class=w> </span><span class=n>delta_exec</span><span class=p>,</span><span class=w> </span><span class=n>curr</span><span class=o>-&gt;</span><span class=n>vruntime</span><span class=p>);</span><span class=w></span>
<span class=w>        </span><span class=n>cpuacct_charge</span><span class=p>(</span><span class=n>curtask</span><span class=p>,</span><span class=w> </span><span class=n>delta_exec</span><span class=p>);</span><span class=w></span>
<span class=w>        </span><span class=n>account_group_exec_runtime</span><span class=p>(</span><span class=n>curtask</span><span class=p>,</span><span class=w> </span><span class=n>delta_exec</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> <p><code>delta_exec</code> 是进程实际的运行时间，由当前时间减去执行的启动时间得到。</p> <p><code>vruntime</code>是在<code>__update_curr</code>函数中更新的，下面来看看。</p> <div class=highlight><pre><span></span><code><span class=cm>/*</span>
<span class=cm>* Update the current task’s runtime statistics. Skip current tasks that</span>
<span class=cm>* are not in our scheduling class.</span>
<span class=cm>*/</span><span class=w></span>
<span class=k>static</span><span class=w> </span><span class=kr>inline</span><span class=w> </span><span class=kt>void</span><span class=w></span>
<span class=nf>__update_curr</span><span class=p>(</span><span class=k>struct</span><span class=w> </span><span class=nc>cfs_rq</span><span class=w> </span><span class=o>*</span><span class=n>cfs_rq</span><span class=p>,</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>sched_entity</span><span class=w> </span><span class=o>*</span><span class=n>curr</span><span class=p>,</span><span class=w></span>
<span class=w>              </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>delta_exec</span><span class=p>)</span><span class=w></span>
<span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>delta_exec_weighted</span><span class=p>;</span><span class=w></span>

<span class=w>    </span><span class=n>schedstat_set</span><span class=p>(</span><span class=n>curr</span><span class=o>-&gt;</span><span class=n>exec_max</span><span class=p>,</span><span class=w> </span><span class=n>max</span><span class=p>((</span><span class=n>u64</span><span class=p>)</span><span class=n>delta_exec</span><span class=p>,</span><span class=w> </span><span class=n>curr</span><span class=o>-&gt;</span><span class=n>exec_max</span><span class=p>));</span><span class=w></span>

<span class=w>    </span><span class=n>curr</span><span class=o>-&gt;</span><span class=n>sum_exec_runtime</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>delta_exec</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=n>schedstat_add</span><span class=p>(</span><span class=n>cfs_rq</span><span class=p>,</span><span class=w> </span><span class=n>exec_clock</span><span class=p>,</span><span class=w> </span><span class=n>delta_exec</span><span class=p>);</span><span class=w></span>
<span class=hll><span class=w>    </span><span class=n>delta_exec_weighted</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>calc_delta_fair</span><span class=p>(</span><span class=n>delta_exec</span><span class=p>,</span><span class=w> </span><span class=n>curr</span><span class=p>);</span><span class=w></span>
</span>
<span class=hll><span class=w>    </span><span class=n>curr</span><span class=o>-&gt;</span><span class=n>vruntime</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>delta_exec_weighted</span><span class=p>;</span><span class=w></span>
</span><span class=w>    </span><span class=n>update_min_vruntime</span><span class=p>(</span><span class=n>cfs_rq</span><span class=p>);</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> <p><code>__update_curr</code>基于所有可运行进程数对实际运行时间<code>delta_exec</code>进行加权，最后将当前进程的<code>vruntime</code>值自增这个加权值。这个函数是由系统定时器周期性调用的，无论进程是可执行状态还是被堵塞处于不可运行状态。</p> <p>因此，<code>vruntime</code>可以准确测量给定进程的运行时间，并由此知道下一个被执行的进程。</p> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../ch3-process-management/ class="md-footer__link md-footer__link--prev" aria-label="Previous: 进程管理" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> 进程管理 </div> </div> </a> <a href=../../kernel-debug/ftrace/ class="md-footer__link md-footer__link--next" aria-label="Next: Ftrace" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Ftrace </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2020 LITREILY </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/litreily target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://www.litreily.top target=_blank rel=noopener title=www.litreily.top class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8h5Z"/></svg> </a> <a href=https://www.litreily.top/leetcode target=_blank rel=noopener title="Leetcode Solutions" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="m502.285 159.704-234-156c-7.987-4.915-16.511-4.96-24.571 0l-234 156C3.714 163.703 0 170.847 0 177.989v155.999c0 7.143 3.714 14.286 9.715 18.286l234 156.022c7.987 4.915 16.511 4.96 24.571 0l234-156.022c6-3.999 9.715-11.143 9.715-18.286V177.989c-.001-7.142-3.715-14.286-9.716-18.285zM278 63.131l172.286 114.858-76.857 51.429L278 165.703V63.131zm-44 0v102.572l-95.429 63.715-76.857-51.429L234 63.131zM44 219.132l55.143 36.857L44 292.846v-73.714zm190 229.715L61.714 333.989l76.857-51.429L234 346.275v102.572zm22-140.858-77.715-52 77.715-52 77.715 52-77.715 52zm22 140.858V346.275l95.429-63.715 76.857 51.429L278 448.847zm190-156.001-55.143-36.857L468 219.132v73.714z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["navigation.tabs"], "search": "../../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../../assets/javascripts/bundle.d6c3db9e.min.js></script> <script src=../../../js/config.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> </body> </html>